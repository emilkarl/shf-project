%header.entry-header
  - user_name = @user.full_name
  %h1.entry-title
    = user_name.empty? ? @user.email : user_name
    - if @user.admin?
      %span.small
        (#{t('.is_an_admin')})

.entry-content.container

  .login-name
    .row
      .col
        = field_or_none("#{t('.email')}", mail_to(@user.email),
                        label_class: 'standard-label',
                        value_class: 'login-email')


  .membership
    %h3.section-title Membership
    .section
      .row
        .col
          = field_or_none("#{t('.membership_number')}", @user.membership_number,
                          label_class: 'standard-label',
                          value_class: 'membership-number')

      = render partial: 'membership_term_status', locals: { user: @user }


  .row.section-title
    .col.mt-2
      - has_none = @user.shf_application.blank? ? 'None' : ''
      %h3= "#{t('application')}: #{has_none}"

  .section
    - unless @user.shf_application.blank?
      .row
        .col.mt-2
          = render partial: 'app_info_as_table', locals: {application: @user.shf_application}

  - if current_user.admin?
    .admin-only
      .row
        .col.admin-note

          %p{class: "membership-packet #{ @user.membership_packet_sent? ? 'sent' : 'not-sent'}",
          id: 'date-membership-packet-sent'}
            = membership_packet_str(@user)

          %p
            #{t('.created')} #{i18n_time_ago_in_words(@user.created_at)}.
          - if @user.last_sign_in_at.blank? && @user.current_sign_in_at.blank?
            %p
              #{@user.email} #{t('.user_has_never_signed_in')}
          - else
            %p
              #{t('.last_login')}:
              #{most_recent_login_time @user}
              (#{i18n_time_ago_in_words(most_recent_login_time @user)})
            %p
              #{t('.logged_in_count')}:
              = @user.sign_in_count
          - if @user.reset_password_sent_at.blank?
            %p
              = t('.password_never_reset')
          - else
            %p
              %b #{t('.reset_password_sent_at')}:
              #{@user.reset_password_sent_at}
              #{i18n_time_ago_in_words(@user.reset_password_sent_at)})

      %hr


  - if @user.member?
    .section
      .row.mt-3
        .col-md-5
          = render partial: 'proof_of_membership',
                   locals: { app_config: @app_configuration, user: @user,
                             context: :user_show }
        .col-md-7.infotext
          %h3= t('.proof_of_membership')
          %p= t('.proof_of_membership_describe')
          %p= t('.image_how_to_use_html',
              download_link: link_to(t('.download_image'),
                                     proof_of_membership_path(@user, render_to: :jpg),
                                     class: 'btn btn-sm btn-outline-secondary'),
              show_link: link_to(t('.show_image'),
                                   proof_of_membership_path(@user, context: :internal),
                                   class: 'btn btn-sm btn-outline-secondary'))
          %p
            = t('.proof_of_membership_photo_needed')
            = link_to(t('devise.registrations.edit.title'), edit_user_registration_path,
                    class: 'underlined_link')
          %p= t('.image_use_guidelines_html', use_guidelines_link: link_to(t('.use_guidelines'),
              'https://hitta.sverigeshundforetagare.se/dokument/innehall/hmarket',
              class: 'underlined_link'))

      - @user.companies.all.each do |company|
        - next unless company.branding_license?
        .row
          .col-sm-12
            %hr
          .col-md-5
            = render partial: 'companies/company_h_brand',
                     locals: { app_config: @app_configuration, company: company,
                               context: :user_show, user: @user }

          .col-md-7.infotext
            %h3= t('.company_h_brand', company: company.name)
            %p= t('.company_h_brand_describe')
            %p= t('.image_how_to_use_html',
                download_link: link_to(t('.download_image'),
                                       company_h_brand_path(company,
                                                             render_to: :jpg),
                                       class: 'btn btn-sm btn-outline-secondary'),
                show_link: link_to(t('.show_image'),
                                   company_h_brand_path(company,
                                                        context: :internal),
                                       class: 'btn btn-sm btn-outline-secondary'))
            %p= t('.image_use_guidelines_html', use_guidelines_link: link_to(t('.use_guidelines'),
                'https://hitta.sverigeshundforetagare.se/dokument/innehall/hmarket',
                class: 'underlined_link'))

= render partial: 'edit_status_modal', locals: { user: @user }
